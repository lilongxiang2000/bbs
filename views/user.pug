extend layout.pug


block body
  if user
    .d-flex.justify-content-end

    if userPosts.length
      div(class='post-list')
        h3.text-center.my-2=user.username
          span.ms-2 发过的帖子
        ul
          each post in userPosts
            li(class='list-group-item list-group-item-action')
              .d-flex.justify-content-between
                a(href=`/post/${post.id}`)
                  h5(class='mb-1')=post.title
                span=post.date
              div(class='d-flex justify-content-between my-2')
                small.text-break=post.content.slice(0, 200) + '...'
                if loginUser && loginUser.username == post.author
                  button.btn.btn-outline-primary.text-nowrap.ms-2(
                    class='deletePost'
                    data-post-id=post.id
                  ) 删除
        script.
          $('.deletePost').on('click', async e => {
            let postID = e.target.dataset.postId
            if (confirm('确认删除吗？（该操作不可撤回！）')) {
              await fetch(`/post/${postID}`, {
                method: 'delete'
              })
              location.href = '/user/#{user.username}'
            }
          })
    else
      div(class='post-list')
        h3.text-center.my-2 暂未发帖
